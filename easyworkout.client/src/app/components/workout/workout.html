<div class="box">
    @if (!isEditMode) {
        <h2><strong>Workout:</strong> {{ workout().name }}
        <button matIconButton [matMenuTriggerFor]="menu" aria-label="menu for workout-related buttons">
            <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="startWorkout()" alt="start workout">
                <mat-icon>fitness_center</mat-icon>
                <span>Start workout</span>
            </button>
            <button mat-menu-item (click)="edit()" alt="edit workout">
                <mat-icon>edit</mat-icon>
                <span>Edit Workout</span>
            </button>
            <button mat-menu-item (click)="delete()" alt="delete workout">
                <mat-icon>delete</mat-icon>
                <span>Delete workout</span>
            </button>
        </mat-menu></h2>
        <div><strong>Notes:</strong> {{ workout().notes }}</div>
        <div><strong>Date created:</strong> {{ workout().addedDate | date:"MMM dd, yyyy" }}</div>
        @if (workout().lastCompletedDate) {
            <div><em>Last completed:</em> {{ workout().lastCompletedDate | date:"MMM dd, yyyy 'at' hh:mm a" }}</div>
        }
        @if (workoutDetail) {
            @for (exercise of workout().exercises | orderBy:'addedDate':'asc'; track exercise.id) {
                <div>
                    <app-exercise [exercise]="exercise" [workoutId]="workout().id" (onExerciseChanged)="reloadWorkout()" /> 
                </div>
            }
            @if (isAddMode) {
                <app-add-exercise (onClose)="closeAddExercise()" [workoutId]="workout().id" />
            } @else {
                <div>
                    <button matIconButton (click)="toggleWorkoutDetail()" alt="hide exercise detail">
                        <mat-icon>expand_less</mat-icon>
                    </button>
                    <button matButton="elevated" (click)="openAddExercise()" alt="add exercise">
                        Add exercise
                    </button>
                </div>
            }
        } @else {
            <div><strong>Number of exercises:</strong> {{ workout().exercises.length }}</div>
            <button matIconButton (click)="toggleWorkoutDetail()" alt="show exercise detail">
                <mat-icon>expand_more</mat-icon>
            </button>
        }
    } @else {
        <h2>Edit Workout:</h2>
        <form [formGroup]="form" (ngSubmit)="update()">
            <mat-form-field>
                <mat-label>Name</mat-label>
                <input matInput placeholder="Name" formControlName="name" />
            </mat-form-field>
            <br />
            <mat-form-field>
                <mat-label>Notes</mat-label>
                <textarea matInput class="text-area" placeholder="Notes" formControlName="notes"></textarea>
            </mat-form-field>
            <br />
            <button matFab extended type="submit" alt="save changes to workout">
                <mat-icon>save</mat-icon>
                Save changes
            </button>
            <div>
                @for (error of validationErrors(); track $index) {
                    <div class="error">{{ error }}</div>
                }
            </div>
        </form>
        <button matButton="elevated" (click)="cancelEdit()" alt="cancel">Cancel</button>
    }
</div>